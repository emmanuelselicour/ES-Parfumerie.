<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ES Parfumerie - Panel Admin</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles spécifiques au panel admin */
        .admin-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .admin-login {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .admin-login h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .admin-panel {
            display: none;
            width: 100%;
            min-height: 100vh;
            background: #f5f5f5;
        }
        
        .admin-header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            min-height: calc(100vh - 70px);
            position: fixed;
            left: 0;
            top: 70px;
        }
        
        .admin-content {
            margin-left: 250px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }
        
        .admin-menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .admin-menu li {
            padding: 0;
        }
        
        .admin-menu a {
            display: block;
            padding: 15px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .admin-menu a:hover,
        .admin-menu a.active {
            background: #34495e;
            border-left-color: #3498db;
        }
        
        .admin-menu i {
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }
        
        .admin-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .admin-section.active {
            display: block;
        }
        
        .admin-section h2 {
            margin-bottom: 25px;
            color: #2c3e50;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin: 10px 0;
            color: #2c3e50;
        }
        
        .stat-card p {
            color: #7f8c8d;
            margin: 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .btn-admin {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-edit {
            background: #3498db;
            color: white;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .btn-add {
            background: #2ecc71;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .admin-alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .admin-sidebar {
                width: 100%;
                position: relative;
                min-height: auto;
                top: 0;
            }
            
            .admin-content {
                margin-left: 0;
            }
            
            .admin-menu {
                display: flex;
                overflow-x: auto;
                padding: 0;
            }
            
            .admin-menu li {
                flex: 0 0 auto;
            }
            
            .admin-menu a {
                padding: 15px;
                white-space: nowrap;
                border-left: none;
                border-bottom: 4px solid transparent;
            }
            
            .admin-menu a:hover,
            .admin-menu a.active {
                border-left: none;
                border-bottom-color: #3498db;
            }
        }
    </style>
</head>
<body>
    <!-- Panel de connexion admin -->
    <div class="admin-container" id="login-container">
        <div class="admin-login">
            <h2><i class="fas fa-lock"></i> Panel Admin ES Parfumerie</h2>
            <form id="admin-login-form">
                <div class="form-group">
                    <input type="email" id="admin-email" placeholder=" " required>
                    <label for="admin-email">Email administrateur</label>
                </div>
                <div class="form-group">
                    <input type="password" id="admin-password" placeholder=" " required>
                    <label for="admin-password">Mot de passe</label>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
            </form>
            <div class="admin-alert" id="login-alert"></div>
        </div>
    </div>
    
    <!-- Panel admin principal -->
    <div class="admin-panel" id="admin-panel">
        <!-- En-tête -->
        <header class="admin-header">
            <div>
                <h2><span style="color: #8a6d3b;">ES</span> Parfumerie - Panel Admin</h2>
                <p id="admin-welcome">Bienvenue, Admin</p>
            </div>
            <div>
                <button id="logout-btn" class="btn-outline">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </header>
        
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <ul class="admin-menu">
                <li><a href="#dashboard" class="active"><i class="fas fa-tachometer-alt"></i> Tableau de bord</a></li>
                <li><a href="#products"><i class="fas fa-wine-bottle"></i> Gestion des produits</a></li>
                <li><a href="#orders"><i class="fas fa-shopping-cart"></i> Commandes</a></li>
                <li><a href="#users"><i class="fas fa-users"></i> Utilisateurs</a></li>
                <li><a href="#settings"><i class="fas fa-cog"></i> Paramètres</a></li>
            </ul>
        </nav>
        
        <!-- Contenu principal -->
        <main class="admin-content">
            <!-- Tableau de bord -->
            <section id="dashboard" class="admin-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Tableau de bord</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-wine-bottle"></i>
                        <h3 id="total-products">0</h3>
                        <p>Produits</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-shopping-cart"></i>
                        <h3 id="total-orders">0</h3>
                        <p>Commandes</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="total-users">0</h3>
                        <p>Utilisateurs</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-euro-sign"></i>
                        <h3 id="total-revenue">0 €</h3>
                        <p>Chiffre d'affaires</p>
                    </div>
                </div>
                
                <h3>Dernières commandes</h3>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Gestion des produits -->
            <section id="products" class="admin-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2><i class="fas fa-wine-bottle"></i> Gestion des produits</h2>
                    <button id="add-product-btn-admin" class="btn-admin btn-add">
                        <i class="fas fa-plus"></i> Ajouter un produit
                    </button>
                </div>
                
                <div class="admin-alert" id="product-alert"></div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nom</th>
                                <th>Catégorie</th>
                                <th>Prix</th>
                                <th>Stock</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-list">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Modal Ajout/Modification de produit -->
            <div class="modal" id="product-modal">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2 id="product-modal-title">Ajouter un produit</h2>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="product-form">
                            <input type="hidden" id="product-id">
                            <div class="form-group">
                                <input type="text" id="product-name-admin" placeholder=" " required>
                                <label for="product-name-admin">Nom du produit</label>
                            </div>
                            <div class="form-group">
                                <textarea id="product-description-admin" placeholder=" " rows="3" required></textarea>
                                <label for="product-description-admin">Description</label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="number" id="product-price-admin" placeholder=" " step="0.01" min="0" required>
                                    <label for="product-price-admin">Prix (€)</label>
                                </div>
                                <div class="form-group">
                                    <input type="number" id="product-stock-admin" placeholder=" " min="0" required>
                                    <label for="product-stock-admin">Stock</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <select id="product-category-admin" required>
                                    <option value="">Sélectionner une catégorie</option>
                                    <option value="men">Homme</option>
                                    <option value="women">Femme</option>
                                    <option value="unisex">Unisex</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="text" id="product-image-admin" placeholder=" " required>
                                <label for="product-image-admin">URL de l'image</label>
                            </div>
                            <div class="form-group">
                                <textarea id="product-features-admin" placeholder=" " rows="3"></textarea>
                                <label for="product-features-admin">Caractéristiques (une par ligne)</label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox">
                                    <input type="checkbox" id="product-active" checked>
                                    <span>Produit actif</span>
                                </label>
                            </div>
                            <button type="submit" class="btn-primary" style="width: 100%;">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Commandes -->
            <section id="orders" class="admin-section">
                <h2><i class="fas fa-shopping-cart"></i> Gestion des commandes</h2>
                <div class="admin-alert" id="order-alert"></div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-list">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Utilisateurs -->
            <section id="users" class="admin-section">
                <h2><i class="fas fa-users"></i> Gestion des utilisateurs</h2>
                <div class="admin-alert" id="user-alert"></div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Rôle</th>
                                <th>Inscription</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-list">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Paramètres -->
            <section id="settings" class="admin-section">
                <h2><i class="fas fa-cog"></i> Paramètres du site</h2>
                
                <form id="settings-form">
                    <div class="form-group">
                        <label for="site-name">Nom du site</label>
                        <input type="text" id="site-name" value="ES Parfumerie">
                    </div>
                    
                    <div class="form-group">
                        <label for="site-email">Email de contact</label>
                        <input type="email" id="site-email" value="contact@es-parfumerie.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="site-currency">Devise</label>
                        <select id="site-currency">
                            <option value="€">Euro (€)</option>
                            <option value="$">Dollar ($)</option>
                            <option value="£">Livre (£)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="site-language">Langue par défaut</label>
                        <select id="site-language">
                            <option value="fr">Français</option>
                            <option value="en">English</option>
                            <option value="es">Español</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox">
                            <input type="checkbox" id="site-maintenance" checked>
                            <span>Site en ligne</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox">
                            <input type="checkbox" id="site-registration" checked>
                            <span>Autoriser les inscriptions</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Enregistrer les paramètres
                    </button>
                </form>
            </section>
        </main>
    </div>

    <script>
        // Configuration API
        const API_BASE_URL = 'https://es-parfumerie-backend.onrender.com';
        
        // État admin
        const AdminState = {
            isAuthenticated: false,
            adminToken: null,
            currentSection: 'dashboard'
        };
        
        // Compte admin par défaut
        const ADMIN_CREDENTIALS = {
            email: 'admin@esparfumerie.com',
            password: 'admin123',
            name: 'Administrateur'
        };
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth();
            setupEventListeners();
        });
        
        // Vérifier l'authentification
        function checkAdminAuth() {
            const token = localStorage.getItem('admin-token');
            const expiry = localStorage.getItem('admin-token-expiry');
            
            if (token && expiry && new Date().getTime() < parseInt(expiry)) {
                AdminState.isAuthenticated = true;
                AdminState.adminToken = token;
                showAdminPanel();
            } else {
                showLoginPanel();
            }
        }
        
        // Afficher le panel de connexion
        function showLoginPanel() {
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('admin-panel').style.display = 'none';
        }
        
        // Afficher le panel admin
        function showAdminPanel() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            loadDashboardData();
        }
        
        // Configurer les événements
        function setupEventListeners() {
            // Connexion admin
            const loginForm = document.getElementById('admin-login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleAdminLogin);
            }
            
            // Déconnexion
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleAdminLogout);
            }
            
            // Navigation admin
            document.querySelectorAll('.admin-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Mettre à jour le menu actif
                    document.querySelectorAll('.admin-menu a').forEach(a => {
                        a.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Afficher la section correspondante
                    const sectionId = this.getAttribute('href').substring(1);
                    showAdminSection(sectionId);
                });
            });
            
            // Modal produit
            const addProductBtn = document.getElementById('add-product-btn-admin');
            if (addProductBtn) {
                addProductBtn.addEventListener('click', () => {
                    showProductModal();
                });
            }
            
            // Fermer modals
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // Formulaire produit
            const productForm = document.getElementById('product-form');
            if (productForm) {
                productForm.addEventListener('submit', handleProductSubmit);
            }
            
            // Formulaire paramètres
            const settingsForm = document.getElementById('settings-form');
            if (settingsForm) {
                settingsForm.addEventListener('submit', handleSettingsSubmit);
            }
        }
        
        // Gestion de la connexion admin
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const alert = document.getElementById('login-alert');
            
            // Validation simple (en production, utiliser l'API)
            if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {
                // Générer un token simple
                const token = btoa(`admin:${Date.now()}`);
                const expiry = new Date().getTime() + (24 * 60 * 60 * 1000); // 24 heures
                
                // Sauvegarder
                localStorage.setItem('admin-token', token);
                localStorage.setItem('admin-token-expiry', expiry.toString());
                
                // Mettre à jour l'état
                AdminState.isAuthenticated = true;
                AdminState.adminToken = token;
                
                // Afficher le panel
                showAdminPanel();
                
                // Mettre à jour le message de bienvenue
                document.getElementById('admin-welcome').textContent = `Bienvenue, ${ADMIN_CREDENTIALS.name}`;
            } else {
                showAlert(alert, 'Identifiants incorrects', 'error');
            }
        }
        
        // Gestion de la déconnexion
        function handleAdminLogout() {
            localStorage.removeItem('admin-token');
            localStorage.removeItem('admin-token-expiry');
            AdminState.isAuthenticated = false;
            AdminState.adminToken = null;
            showLoginPanel();
        }
        
        // Afficher une section admin
        function showAdminSection(sectionId) {
            // Masquer toutes les sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Afficher la section demandée
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
                AdminState.currentSection = sectionId;
                
                // Charger les données si nécessaire
                switch(sectionId) {
                    case 'products':
                        loadProducts();
                        break;
                    case 'orders':
                        loadOrders();
                        break;
                    case 'users':
                        loadUsers();
                        break;
                    case 'dashboard':
                        loadDashboardData();
                        break;
                }
            }
        }
        
        // Charger les données du tableau de bord
        async function loadDashboardData() {
            try {
                // Charger les statistiques
                const statsResponse = await fetch(`${API_BASE_URL}/api/dashboard/stats`, {
                    headers: {
                        'Authorization': `Bearer ${AdminState.adminToken}`
                    }
                });
                
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    updateDashboardStats(stats);
                }
                
                // Charger les dernières commandes
                const ordersResponse = await fetch(`${API_BASE_URL}/api/orders?limit=5`, {
                    headers: {
                        'Authorization': `Bearer ${AdminState.adminToken}`
                    }
                });
                
                if (ordersResponse.ok) {
                    const orders = await ordersResponse.json();
                    updateRecentOrders(orders);
                }
                
            } catch (error) {
                console.error('Erreur lors du chargement du dashboard:', error);
                // Données de démonstration
                updateDashboardStats({
                    totalProducts: 0,
                    totalOrders: 0,
                    totalUsers: 0,
                    totalRevenue: 0
                });
            }
        }
        
        // Mettre à jour les statistiques
        function updateDashboardStats(stats) {
            document.getElementById('total-products').textContent = stats.totalProducts || 0;
            document.getElementById('total-orders').textContent = stats.totalOrders || 0;
            document.getElementById('total-users').textContent = stats.totalUsers || 0;
            document.getElementById('total-revenue').textContent = `${stats.totalRevenue || 0} €`;
        }
        
        // Mettre à jour les dernières commandes
        function updateRecentOrders(orders) {
            const tbody = document.getElementById('recent-orders');
            if (!tbody) return;
            
            if (!orders || orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <i class="fas fa-shopping-cart" style="font-size: 2rem; color: #ddd; margin-bottom: 10px;"></i>
                            <p>Aucune commande</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td>#${order.order_number || order.id}</td>
                    <td>${order.user_name || 'Client'}</td>
                    <td>${new Date(order.created_at).toLocaleDateString()}</td>
                    <td>${order.total_amount} €</td>
                    <td>
                        <span class="order-status" style="
                            padding: 5px 10px;
                            border-radius: 20px;
                            font-size: 0.85rem;
                            background: ${getStatusColor(order.status)};
                            color: white;
                        ">
                            ${order.status}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
        
        // Couleur selon le statut
        function getStatusColor(status) {
            const colors = {
                'pending': '#f39c12',
                'processing': '#3498db',
                'shipped': '#9b59b6',
                'delivered': '#2ecc71',
                'cancelled': '#e74c3c'
            };
            return colors[status] || '#95a5a6';
        }
        
        // Charger les produits
        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/products`);
                
                if (response.ok) {
                    const data = await response.json();
                    displayProductsAdmin(data.products);
                } else {
                    showAlert(document.getElementById('product-alert'), 
                             'Erreur lors du chargement des produits', 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showAlert(document.getElementById('product-alert'), 
                         'Erreur de connexion au serveur', 'error');
            }
        }
        
        // Afficher les produits dans l'admin
        function displayProductsAdmin(products) {
            const tbody = document.getElementById('products-list');
            if (!tbody) return;
            
            if (!products || products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <i class="fas fa-box-open" style="font-size: 2rem; color: #ddd; margin-bottom: 10px;"></i>
                            <p>Aucun produit disponible</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${product.image_url || 'https://via.placeholder.com/50'}" 
                                 alt="${product.name}" 
                                 style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                            ${product.name}
                        </div>
                    </td>
                    <td>
                        <span class="product-category-badge" style="
                            padding: 5px 10px;
                            border-radius: 20px;
                            font-size: 0.85rem;
                            background: ${getCategoryColor(product.category)};
                            color: white;
                        ">
                            ${product.category === 'men' ? 'Homme' : 
                              product.category === 'women' ? 'Femme' : 'Unisex'}
                        </span>
                    </td>
                    <td>${product.price} €</td>
                    <td>
                        <span class="stock-badge" style="
                            padding: 5px 10px;
                            border-radius: 20px;
                            font-size: 0.85rem;
                            background: ${product.stock > 10 ? '#2ecc71' : 
                                        product.stock > 0 ? '#f39c12' : '#e74c3c'};
                            color: white;
                        ">
                            ${product.stock}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge" style="
                            padding: 5px 10px;
                            border-radius: 20px;
                            font-size: 0.85rem;
                            background: ${product.is_active ? '#2ecc71' : '#e74c3c'};
                            color: white;
                        ">
                            ${product.is_active ? 'Actif' : 'Inactif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn-admin btn-edit" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-admin btn-delete" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Couleur par catégorie
        function getCategoryColor(category) {
            const colors = {
                'men': '#3498db',
                'women': '#e84393',
                'unisex': '#9b59b6'
            };
            return colors[category] || '#95a5a6';
        }
        
        // Afficher le modal produit
        function showProductModal(product = null) {
            const modal = document.getElementById('product-modal');
            const title = document.getElementById('product-modal-title');
            const form = document.getElementById('product-form');
            
            if (product) {
                // Mode édition
                title.textContent = 'Modifier le produit';
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name-admin').value = product.name;
                document.getElementById('product-description-admin').value = product.description;
                document.getElementById('product-price-admin').value = product.price;
                document.getElementById('product-stock-admin').value = product.stock;
                document.getElementById('product-category-admin').value = product.category;
                document.getElementById('product-image-admin').value = product.image_url || '';
                document.getElementById('product-features-admin').value = product.features ? 
                    product.features.join('\n') : '';
                document.getElementById('product-active').checked = product.is_active !== false;
            } else {
                // Mode création
                title.textContent = 'Ajouter un produit';
                form.reset();
                document.getElementById('product-id').value = '';
                document.getElementById('product-active').checked = true;
            }
            
            modal.classList.add('active');
        }
        
        // Gérer l'envoi du formulaire produit
        async function handleProductSubmit(e) {
            e.preventDefault();
            
            const productId = document.getElementById('product-id').value;
            const productData = {
                name: document.getElementById('product-name-admin').value,
                description: document.getElementById('product-description-admin').value,
                price: parseFloat(document.getElementById('product-price-admin').value),
                stock: parseInt(document.getElementById('product-stock-admin').value),
                category: document.getElementById('product-category-admin').value,
                image_url: document.getElementById('product-image-admin').value,
                features: document.getElementById('product-features-admin').value
                    .split('\n')
                    .filter(f => f.trim() !== ''),
                is_active: document.getElementById('product-active').checked
            };
            
            try {
                let response;
                
                if (productId) {
                    // Mise à jour
                    response = await fetch(`${API_BASE_URL}/api/products/${productId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${AdminState.adminToken}`
                        },
                        body: JSON.stringify(productData)
                    });
                } else {
                    // Création
                    response = await fetch(`${API_BASE_URL}/api/products`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${AdminState.adminToken}`
                        },
                        body: JSON.stringify(productData)
                    });
                }
                
                if (response.ok) {
                    const modal = document.getElementById('product-modal');
                    modal.classList.remove('active');
                    
                    showAlert(document.getElementById('product-alert'), 
                             'Produit enregistré avec succès', 'success');
                    
                    // Recharger la liste
                    loadProducts();
                    
                    // Mettre à jour le dashboard
                    if (AdminState.currentSection === 'dashboard') {
                        loadDashboardData();
                    }
                } else {
                    showAlert(document.getElementById('product-alert'), 
                             'Erreur lors de l\'enregistrement', 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showAlert(document.getElementById('product-alert'), 
                         'Erreur de connexion au serveur', 'error');
            }
        }
        
        // Éditer un produit
        async function editProduct(productId) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/products/${productId}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showProductModal(data.product);
                }
            } catch (error) {
                console.error('Erreur:', error);
                showAlert(document.getElementById('product-alert'), 
                         'Erreur lors du chargement du produit', 'error');
            }
        }
        
        // Supprimer un produit
        async function deleteProduct(productId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${AdminState.adminToken}`
                    }
                });
                
                if (response.ok) {
                    showAlert(document.getElementById('product-alert'), 
                             'Produit supprimé avec succès', 'success');
                    
                    // Recharger la liste
                    loadProducts();
                    
                    // Mettre à jour le dashboard
                    if (AdminState.currentSection === 'dashboard') {
                        loadDashboardData();
                    }
                } else {
                    showAlert(document.getElementById('product-alert'), 
                             'Erreur lors de la suppression', 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showAlert(document.getElementById('product-alert'), 
                         'Erreur de connexion au serveur', 'error');
            }
        }
        
        // Charger les commandes
        async function loadOrders() {
            // Simulation pour l'exemple
            const orders = [
                {
                    id: 1,
                    order_number: 'ES2023001',
                    user_name: 'Jean Dupont',
                    created_at: '2023-10-15',
                    total_amount: 89.99,
                    status: 'delivered'
                },
                {
                    id: 2,
                    order_number: 'ES2023002',
                    user_name: 'Marie Martin',
                    created_at: '2023-10-16',
                    total_amount: 155.50,
                    status: 'processing'
                }
            ];
            
            updateOrdersList(orders);
        }
        
        // Mettre à jour la liste des commandes
        function updateOrdersList(orders) {
            const tbody = document.getElementById('orders-list');
            if (!tbody) return;
            
            if (!orders || orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <i class="fas fa-shopping-cart" style="font-size: 2rem; color: #ddd; margin-bottom: 10px;"></i>
                            <p>Aucune commande</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td>${order.order_number}</td>
                    <td>${order.user_name}</td>
                    <td>${new Date(order.created_at).toLocaleDateString()}</td>
                    <td>${order.total_amount} €</td>
                    <td>
                        <select class="order-status-select" data-id="${order.id}" 
                                style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ddd;">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>En attente</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>En traitement</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Expédié</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Livré</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Annulé</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn-admin btn-edit" onclick="viewOrder(${order.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Charger les utilisateurs
        async function loadUsers() {
            // Simulation pour l'exemple
            const users = [
                {
                    id: 1,
                    first_name: 'Admin',
                    last_name: 'System',
                    email: 'admin@esparfumerie.com',
                    role: 'admin',
                    created_at: '2023-01-01'
                },
                {
                    id: 2,
                    first_name: 'Jean',
                    last_name: 'Dupont',
                    email: 'jean.dupont@email.com',
                    role: 'user',
                    created_at: '2023-10-01'
                }
            ];
            
            updateUsersList(users);
        }
        
        // Mettre à jour la liste des utilisateurs
        function updateUsersList(users) {
            const tbody = document.getElementById('users-list');
            if (!tbody) return;
            
            if (!users || users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <i class="fas fa-users" style="font-size: 2rem; color: #ddd; margin-bottom: 10px;"></i>
                            <p>Aucun utilisateur</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.first_name} ${user.last_name}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="role-badge" style="
                            padding: 5px 10px;
                            border-radius: 20px;
                            font-size: 0.85rem;
                            background: ${user.role === 'admin' ? '#e74c3c' : '#3498db'};
                            color: white;
                        ">
                            ${user.role === 'admin' ? 'Administrateur' : 'Utilisateur'}
                        </span>
                    </td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn-admin btn-edit" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.role !== 'admin' ? `
                            <button class="btn-admin btn-delete" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }
        
        // Gérer les paramètres
        function handleSettingsSubmit(e) {
            e.preventDefault();
            alert('Paramètres enregistrés avec succès !');
        }
        
        // Afficher une alerte
        function showAlert(container, message, type = 'success') {
            if (!container) return;
            
            container.textContent = message;
            container.className = 'admin-alert';
            container.classList.add(`alert-${type}`);
            container.style.display = 'block';
            
            // Masquer après 5 secondes
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }
        
        // Exposer les fonctions globales
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.viewOrder = function(id) {
            alert(`Voir la commande #${id}`);
        };
        window.editUser = function(id) {
            alert(`Éditer l'utilisateur #${id}`);
        };
        window.deleteUser = function(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
                alert(`Utilisateur #${id} supprimé`);
            }
        };
    </script>
</body>
</html>
